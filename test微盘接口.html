<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>微盘接口测试</title>
    <script src="echarts.js"></script>
    <script src="js/jquery-1.11.3.js"></script>
</head>

<body>

    <div id="app" style="width:900px;height:500px;"></div>

    <!--    <script src="http://112.74.212.112:8090/app-api/api/KLine/getNewKLine.do?p={'type':'1','contract':'OIL'}&jsonp=parseResponse "></script>-->
    <script>
        var myChart = echarts.init(document.getElementById('app'));
        /*var a = {
                                                'type': '1',
                                                'contract': 'OIL'
                                            }*/
        //        console.log(JSON.stringify(a))
        function getData() {


            $.ajax({
                type: 'get',
                //            url: 'http://112.74.212.112:8090/app-api/api/KLine/getNewKLine.do',
                url: 'http://192.168.0.57:8080/WeipanDemo/Weipan',
                //            dataType: 'json',
                dataType: 'jsonp',
                //            data: {
                //                p: JSON.stringify(a)
                //            },
                jsonp: 'jsonpcallback',
                success: function (msg) {
                    //                console.log(msg.result.dataList)
                    var data = [];
                    for (var i = 0; i < msg.result.dataList.length; i++) {
                        data.unshift(msg.result.dataList[i]);

                    }
                    //                console.log(data);
                    var date = [];
                    for (var i = 0; i < msg.result.dateList.length; i++) {
                        date.unshift(msg.result.dateList[i]);

                    }
                    //                console.log(date)
                    option = {
                        title: {
                            text: 'Ajax轮询自动刷新 V0.0.1'
                        },
                        tooltip: {
                            trigger: 'axis',
                            formatter: function (params) {
                                return '时间：' + params[0].name + '<br/>最新价格：' + params[0].value;
                                //                            console.log(params[0])

                            },
                            axisPointer: {
                                type: 'line',
                                lineStyle: {
                                    color: '#48b',
                                    width: 2,
                                    type: 'solid'
                                },
                                crossStyle: {
                                    color: '#1e90ff',
                                    width: 1,
                                    type: 'dashed'
                                },
                                shadowStyle: {
                                    color: 'rgba(150,150,150,0.3)',
                                    width: 'auto',
                                    type: 'default'
                                }
                            }
                        },
                        xAxis: {
                            //                        type: 'time',
                            splitLine: {
                                show: true
                            },
                            data: date,
                            boundaryGap: false,
                        },
                        yAxis: {
                            type: 'value',
                            //                        boundaryGap:false,
                            //                        boundaryGap: [0, 10],
                            scale: true,
                            splitLine: {
                                show: true
                            },
                            boundaryGap: false,
                            spliteArea: {
                                //                            show: true,
                                areaStyle: {
                                    type: 'default',
                                    //                                color: rgba(3,3,3)

                                }
                            },

                        },
                        backgroundColor: 'rgba(68, 159, 250, 0.3)',
                        series: [{
                            name: '模拟数据',
                            type: 'line',
                            //                        showSymbol: false,
                            //                        hoverAnimation: false,
                            data: data,
                            smooth: false,
                            dataFilter: 'nearst',
                            //                        clickable:false,
                            symbol: 'none',
                            areaStyle: {
                                normal: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                        offset: 0,
                                        color: 'rgb(255, 158, 68)'
                    }, {
                                        offset: 1,
                                        color: 'rgb(255, 70, 131)'
                    }])
                                }
                            }

                    }],
                        /*timeLine: {
                            show: true
                        },*/

                    };
                                    myChart.setOption(option);
//                    app.timeTicket = setInterval(function () {

//                        for (var i = 0; i < 5; i++) {
                            //                data.shift();
//                            data.push(randomData());
//                        }

                        myChart.setOption(option);
//                    }, 1000);

                },
                error: function (XmlHttpRequest, textStatus, errorThrown) {
                    alert("部门切换失败，请联系管理员!");
                }

            })
        }
        getData();
        setInterval(getData,30000)
    </script>
</body>

</html>
